<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Calculadora de Volume de Prancha - Board's Point</title>
  
  <!-- Meta tags para SEO -->
  <meta name="description" content="Encontre a prancha perfeita com nossa calculadora de volume. Board's Point - Especialistas em surf.">
  <meta name="keywords" content="surf, prancha, volume, calculadora, board point">
  <meta name="author" content="Board's Point">
  
  <!-- Open Graph -->
  <meta property="og:title" content="Calculadora de Volume de Prancha - Board's Point">
  <meta property="og:description" content="Encontre a prancha perfeita com nossa calculadora de volume. Board's Point - Especialistas em surf.">
  <meta property="og:image" content="https://bp.ocoworks.com/og-image.jpg">
  <meta property="og:url" content="https://bp.ocoworks.com/surfboard-volume-calculator.html">
  <meta property="og:type" content="website">
  
  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Calculadora de Volume de Prancha - Board's Point">
  <meta name="twitter:description" content="Encontre a prancha perfeita com nossa calculadora de volume. Board's Point - Especialistas em surf.">
  <meta name="twitter:image" content="https://bp.ocoworks.com/og-image.jpg">
  
  <!-- Canonical URL -->
  <link rel="canonical" href="https://bp.ocoworks.com/surfboard-volume-calculator.html">
  
  <style>
    * { box-sizing: border-box; }
    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      margin: 0; 
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    .container { 
      background: #fff; 
      padding: 32px; 
      border-radius: 16px; 
      max-width: 600px; 
      margin: auto; 
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    h1 { 
      text-align: center; 
      color: #2c3e50;
      margin-bottom: 8px;
      font-size: 2.2em;
    }
    .subtitle {
      text-align: center;
      color: #7f8c8d;
      margin-bottom: 32px;
      font-size: 1.1em;
    }
    .form-group { 
      margin-bottom: 20px; 
    }
    label { 
      display: block; 
      margin-bottom: 8px;
      font-weight: 600;
      color: #2c3e50;
    }
    select, input { 
      width: 100%; 
      padding: 12px 16px; 
      border-radius: 8px; 
      border: 2px solid #e1e8ed;
      font-size: 16px;
      transition: all 0.3s ease;
    }
    select:focus, input:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    .btn {
      padding: 14px 24px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
      margin-top: 8px;
    }
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }
    .btn-secondary {
      background: #f8f9fa;
      color: #495057;
      border: 2px solid #e9ecef;
    }
    .btn-secondary:hover {
      background: #e9ecef;
    }
    .result { 
      margin-top: 32px;
      padding: 24px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 12px;
      text-align: center;
    }
    .volume-display {
      font-size: 2.5em;
      font-weight: bold;
      margin: 16px 0;
    }
    .recommendations { 
      margin-top: 24px; 
    }
    .board { 
      background: #f8f9fa; 
      padding: 20px; 
      border-radius: 12px; 
      margin-bottom: 16px;
      border: 1px solid #e9ecef;
      transition: all 0.3s ease;
    }
    .board:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }
    .board img {
      max-width: 150px;
      border-radius: 8px;
      margin: 12px 0;
    }
    .loading {
      text-align: center;
      padding: 40px;
      color: #7f8c8d;
    }
    .error {
      background: #fee;
      color: #c33;
      padding: 16px;
      border-radius: 8px;
      border: 1px solid #fcc;
    }
    .success {
      background: #efe;
      color: #363;
      padding: 16px;
      border-radius: 8px;
      border: 1px solid #cfc;
    }
    .advanced-toggle {
      margin: 24px 0;
      text-align: center;
    }
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }
    .footer {
      margin-top: 40px;
      text-align: center;
      color: #7f8c8d;
      font-size: 0.9em;
    }
    .footer a {
      color: #667eea;
      text-decoration: none;
    }
    .footer a:hover {
      text-decoration: underline;
    }
    @media (max-width: 768px) {
      .form-row {
        grid-template-columns: 1fr;
      }
      .container {
        margin: 10px;
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üèÑ‚Äç‚ôÇÔ∏è Calculadora de Volume</h1>
    <p class="subtitle">Encontre a prancha perfeita para voc√™</p>
    
    <form id="volumeForm">
      <div class="form-row">
        <div class="form-group">
          <label>Peso (kg)</label>
          <input type="number" id="peso" required min="30" max="150" step="0.1" placeholder="Ex: 70">
        </div>
        <div class="form-group">
          <label>Altura (cm)</label>
          <input type="number" id="altura" required min="120" max="220" placeholder="Ex: 175">
        </div>
      </div>
      
      <div class="form-row">
        <div class="form-group">
          <label>Idade</label>
          <input type="number" id="idade" required min="10" max="80" placeholder="Ex: 30">
        </div>
        <div class="form-group">
          <label>Habilidade</label>
          <select id="habilidade" required>
            <option value="">Selecione...</option>
            <option value="iniciante">Iniciante</option>
            <option value="intermediario">Intermedi√°rio</option>
            <option value="avancado">Avan√ßado</option>
            <option value="pro">Profissional</option>
          </select>
        </div>
      </div>
      
      <div class="form-group">
        <label>Condicionamento F√≠sico</label>
        <select id="condicao" required>
          <option value="">Selecione...</option>
          <option value="baixo">Baixo</option>
          <option value="medio">M√©dio</option>
          <option value="alto">Alto</option>
        </select>
      </div>
      
      <div class="advanced-toggle">
        <button type="button" class="btn btn-secondary" onclick="toggleAdvanced()">
          ‚öôÔ∏è Configura√ß√µes Avan√ßadas
        </button>
      </div>
      
      <div id="advancedOptions" style="display: none;">
        <div class="form-group">
          <label>Tamanho das Ondas</label>
          <select id="onda">
            <option value="">N√£o especificado</option>
            <option value="pequena">Pequenas (at√© 1m)</option>
            <option value="media">M√©dias (1-2m)</option>
            <option value="grande">Grandes (acima de 2m)</option>
          </select>
        </div>
        
        <div class="form-group">
          <label>Guild Factor Manual</label>
          <input type="range" id="gf" min="0.30" max="0.60" step="0.01" value="0.42">
          <div style="text-align: center; margin-top: 8px;">
            <span id="gf-value">0.42</span>
            <small style="color: #7f8c8d;">(Ajuste fino do c√°lculo)</small>
          </div>
        </div>
      </div>
      
      <button type="submit" class="btn btn-primary">
        üßÆ Calcular Volume
      </button>
    </form>
    
    <div id="resultado" class="result" style="display: none;"></div>
    
    <div id="resultados"></div>
    
    <div class="footer">
      <p>Desenvolvido com ‚ù§Ô∏è pela <a href="https://bp.ocoworks.com" target="_blank">Board's Point</a></p>
      <p>Baseado no Guild Factor de John Whitney Guild</p>
    </div>
  </div>

  <script>
    // Debug function
    function debugLog(message) {
      console.log(`[DEBUG] ${message}`);
    }
    
    // Toggle advanced options
    function toggleAdvanced() {
      const advanced = document.getElementById('advancedOptions');
      advanced.style.display = advanced.style.display === 'none' ? 'block' : 'none';
    }
    
    // Valida√ß√£o em tempo real
    function validateForm() {
      const peso = parseFloat(document.getElementById('peso').value);
      const altura = parseInt(document.getElementById('altura').value);
      const idade = parseInt(document.getElementById('idade').value);
      
      let isValid = true;
      let message = '';
      
      if (peso < 30 || peso > 150) {
        message += 'Peso deve estar entre 30 e 150 kg.\n';
        isValid = false;
      }
      
      if (altura < 120 || altura > 220) {
        message += 'Altura deve estar entre 120 e 220 cm.\n';
        isValid = false;
      }
      
      if (idade < 10 || idade > 80) {
        message += 'Idade deve estar entre 10 e 80 anos.\n';
        isValid = false;
      }
      
      return { isValid, message };
    }

    // Fun√ß√£o para sugerir GF padr√£o por habilidade
    function getGuildFactor(habilidade) {
      switch (habilidade) {
        case 'pro':
          return 0.33;
        case 'avancado':
          return 0.36;
        case 'intermediario':
          return 0.40;
        case 'iniciante':
          return 0.52;
        default:
          return 0.38;
      }
    }

    // Algoritmo de c√°lculo de volume usando GF ajust√°vel
    function calcularVolume(peso, habilidade, idade, condicao, onda, gfManual) {
      // Usar GF manual se fornecido, sen√£o sugerido
      let gf = gfManual !== undefined && gfManual !== null ? gfManual : getGuildFactor(habilidade);
      let volume = peso * gf;
      // Ajustes finos
      if (idade > 45) volume += 2;
      if (condicao === 'baixo') volume += 2;
      if (onda === 'pequena') volume += 3;
      if (onda === 'grande') volume -= 3;
      return Math.round(volume * 10) / 10;
    }

    // Atualizar GF sugerido ao mudar habilidade
    document.getElementById('habilidade').addEventListener('change', function() {
      const habilidade = this.value;
      const gfSugerido = getGuildFactor(habilidade);
      const gfSlider = document.getElementById('gf');
      gfSlider.value = gfSugerido;
      document.getElementById('gf-value').innerText = gfSugerido;
    });

    // Atualizar valor do slider em tempo real
    document.getElementById('gf').addEventListener('input', function() {
      document.getElementById('gf-value').innerText = this.value;
    });

    // Fun√ß√£o para obter recomenda√ß√£o baseada no volume
    function getRecomendacao(volume, habilidade) {
      if (volume < 30) {
        return "Considere uma prancha maior para mais estabilidade.";
      } else if (volume > 80) {
        return "Voc√™ pode usar uma prancha menor para mais manobrabilidade.";
      } else {
        return "Volume ideal para seu perfil!";
      }
    }

    // Fun√ß√£o para mostrar mensagens
    function mostrarMensagem(mensagem, tipo = 'info') {
      const resultadosDiv = document.getElementById('resultados');
      const alertClass = tipo === 'error' ? 'error' : tipo === 'warning' ? 'error' : 'success';
      
      resultadosDiv.innerHTML = `
        <div class="${alertClass}">
          <h4>${tipo === 'error' ? '‚ùå Erro' : tipo === 'warning' ? '‚ö†Ô∏è Aviso' : '‚ÑπÔ∏è Informa√ß√£o'}</h4>
          <p>${mensagem}</p>
        </div>
      `;
      
      document.getElementById('resultados').scrollIntoView({ behavior: 'smooth' });
    }

    // Fun√ß√£o para mostrar loading
    function showLoading(show) {
      const resultadosDiv = document.getElementById('resultados');
      if (show) {
        resultadosDiv.innerHTML = `
          <div class="loading">
            <div style="font-size: 2em;">üîÑ</div>
            <p>üîç Buscando pranchas recomendadas...</p>
          </div>
        `;
      }
    }

    // Fun√ß√£o para mostrar resultados
    function mostrarResultados(pranchas, volumeCalculado, buscaAmpliada = false) {
      debugLog(`Mostrando ${pranchas.length} pranchas para volume ${volumeCalculado}L`);
      
      const resultadosDiv = document.getElementById('resultados');
      
      if (!pranchas || pranchas.length === 0) {
        resultadosDiv.innerHTML = `
          <div class="error">
            <h4>Nenhuma prancha encontrada</h4>
            <p>N√£o encontramos pranchas com o volume calculado (${volumeCalculado}L).</p>
            <p>Tente:</p>
            <ul>
              <li>Ajustar os par√¢metros de c√°lculo</li>
              <li>Verificar se h√° produtos cadastrados na loja</li>
              <li>Testar com diferentes categorias de prancha</li>
            </ul>
          </div>
        `;
        return;
      }
      
      let html = `
        <div style="margin-top: 24px;">
          <h3>üèÑ‚Äç‚ôÇÔ∏è Pranchas Recomendadas</h3>
          <div style="margin-bottom: 16px;">
            <span style="background: #667eea; color: white; padding: 8px 16px; border-radius: 20px; font-weight: bold;">
              Volume Calculado: ${volumeCalculado}L
            </span>
            <p style="color: #7f8c8d; font-size: 0.9em; margin-top: 8px;">
              Baseado no Guild Factor de John Whitney Guild
            </p>
            ${buscaAmpliada ? '<p style="color: #f39c12; font-size: 0.9em;">‚ö†Ô∏è Busca ampliada para encontrar mais op√ß√µes</p>' : ''}
          </div>
        </div>
      `;
      
      pranchas.forEach((prancha, index) => {
        const diferenca = Math.abs(prancha.volume - volumeCalculado);
        const diferencaPercentual = ((diferenca / volumeCalculado) * 100).toFixed(1);
        
        let badgeColor = '#28a745';
        if (diferencaPercentual > 15) badgeColor = '#ffc107';
        if (diferencaPercentual > 25) badgeColor = '#dc3545';
        
        html += `
          <div class="board">
            <div style="display: flex; gap: 16px; align-items: start;">
              ${prancha.images && prancha.images.length > 0 ? `
                <img src="${prancha.images[0].src}" alt="${prancha.name}" style="width: 100px; height: 100px; object-fit: cover; border-radius: 8px;">
              ` : `
                <div style="width: 100px; height: 100px; background: #f8f9fa; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #7f8c8d;">
                  üèÑ‚Äç‚ôÇÔ∏è
                </div>
              `}
              <div style="flex: 1;">
                <h4 style="margin: 0 0 8px 0; color: #2c3e50;">${prancha.name}</h4>
                <div style="margin-bottom: 8px;">
                  <span style="background: ${badgeColor}; color: white; padding: 4px 8px; border-radius: 4px; font-size: 0.9em; font-weight: bold;">
                    ${prancha.volume}L 
                    <small>(${diferencaPercentual}% ${prancha.volume > volumeCalculado ? 'maior' : 'menor'})</small>
                  </span>
                </div>
                <p style="margin: 8px 0; color: #7f8c8d;">
                  <strong>Categoria:</strong> ${prancha.categoria}
                </p>
                <div style="margin-top: 12px;">
                  <a href="https://bp.ocoworks.com/produto/${prancha.handle.pt || prancha.handle}" target="_blank" style="background: #667eea; color: white; padding: 8px 16px; text-decoration: none; border-radius: 4px; font-size: 0.9em;">
                    üõí Ver Produto
                  </a>
                </div>
              </div>
            </div>
          </div>
        `;
      });
      
      html += `
        <div style="margin-top: 24px; padding: 16px; background: #f8f9fa; border-radius: 8px;">
          <h6 style="margin: 0 0 12px 0; color: #2c3e50;">üí° Dicas para escolher sua prancha:</h6>
          <ul style="margin: 0; padding-left: 20px; color: #7f8c8d;">
            <li>Pranchas com volume pr√≥ximo ao calculado oferecem melhor flutua√ß√£o</li>
            <li>Considere sua experi√™ncia e condicionamento f√≠sico</li>
            <li>Teste diferentes categorias para encontrar o que funciona melhor para voc√™</li>
            <li>O Guild Factor √© uma refer√™ncia - ajuste conforme sua prefer√™ncia</li>
          </ul>
        </div>
      `;
      
      resultadosDiv.innerHTML = html;
      document.getElementById('resultados').scrollIntoView({ behavior: 'smooth' });
    }

    // Fun√ß√£o para buscar pranchas recomendadas
    async function buscarPranchas(volumeCalculado, categoria) {
      debugLog(`Iniciando busca para volume ${volumeCalculado}L`);
      
      try {
        showLoading(true);
        
        // Toler√¢ncia MUITO mais flex√≠vel para encontrar mais pranchas
        const tolerancia = Math.max(volumeCalculado * 0.30, 8); // 30% ou m√≠nimo 8L
        const volumeMin = volumeCalculado - tolerancia;
        const volumeMax = volumeCalculado + tolerancia;
        
        debugLog(`Buscando pranchas: Volume ${volumeCalculado}L ¬± ${tolerancia}L (${volumeMin}L - ${volumeMax}L)`);
        
        const response = await fetch('https://bp2.ocoworks.com/nuvemshop-proxy-vps.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            volume_min: volumeMin,
            volume_max: volumeMax,
            categoria: categoria || 'todas'
          })
        });
        
        debugLog(`Response status: ${response.status}`);
        
        if (!response.ok) {
          throw new Error(`Erro HTTP: ${response.status}`);
        }
        
        const data = await response.json();
        debugLog(`Response data: ${JSON.stringify(data).substring(0, 200)}...`);
        
        if (data.success) {
          const pranchas = data.products || [];
          debugLog(`Encontrados ${pranchas.length} produtos`);
          
          if (pranchas.length > 0) {
            // Ordenar por proximidade do volume calculado
            pranchas.sort((a, b) => {
              const diffA = Math.abs(a.volume - volumeCalculado);
              const diffB = Math.abs(b.volume - volumeCalculado);
              return diffA - diffB;
            });
            
            // Mostrar mais pranchas (at√© 12)
            const pranchasRecomendadas = pranchas.slice(0, 12);
            
            mostrarResultados(pranchasRecomendadas, volumeCalculado);
          } else {
            // Se n√£o encontrou nada, tentar com toler√¢ncia MUITO maior
            const toleranciaAmpliada = Math.max(volumeCalculado * 0.50, 12); // 50% ou m√≠nimo 12L
            const volumeMinAmpliado = volumeCalculado - toleranciaAmpliada;
            const volumeMaxAmpliado = volumeCalculado + toleranciaAmpliada;
            
            debugLog(`Tentando busca ampliada: Volume ${volumeCalculado}L ¬± ${toleranciaAmpliada}L (${volumeMinAmpliado}L - ${volumeMaxAmpliado}L)`);
            
            const responseAmpliado = await fetch('https://bp2.ocoworks.com/nuvemshop-proxy-vps.php', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({
                volume_min: volumeMinAmpliado,
                volume_max: volumeMaxAmpliado,
                categoria: 'todas'
              })
            });
            
            if (responseAmpliado.ok) {
              const dataAmpliado = await responseAmpliado.json();
              if (dataAmpliado.success && dataAmpliado.products && dataAmpliado.products.length > 0) {
                const pranchasAmpliadas = dataAmpliado.products.sort((a, b) => {
                  const diffA = Math.abs(a.volume - volumeCalculado);
                  const diffB = Math.abs(b.volume - volumeCalculado);
                  return diffA - diffB;
                }).slice(0, 8);
                
                mostrarResultados(pranchasAmpliadas, volumeCalculado, true);
              } else {
                mostrarMensagem('Nenhuma prancha encontrada. Verifique se h√° produtos cadastrados na loja ou se os volumes est√£o sendo extra√≠dos corretamente.', 'warning');
              }
            } else {
              mostrarMensagem('Nenhuma prancha encontrada com o volume calculado. Tente ajustar os par√¢metros ou verifique se h√° produtos cadastrados.', 'warning');
            }
          }
        } else {
          throw new Error(data.error || 'Erro desconhecido');
        }
      } catch (error) {
        debugLog(`Erro na busca: ${error.message}`);
        console.error('Erro ao buscar pranchas:', error);
        mostrarMensagem('Erro ao conectar com a loja. Verifique sua conex√£o e tente novamente.', 'error');
      } finally {
        showLoading(false);
      }
    }

    // Handler do formul√°rio
    document.getElementById('volumeForm').onsubmit = async function(e) {
      e.preventDefault();
      debugLog('Formul√°rio submetido');
      
      const validation = validateForm();
      if (!validation.isValid) {
        alert('Por favor, corrija os seguintes erros:\n' + validation.message);
        return;
      }
      
      const peso = parseFloat(document.getElementById('peso').value);
      const idade = parseInt(document.getElementById('idade').value);
      const condicao = document.getElementById('condicao').value;
      const habilidade = document.getElementById('habilidade').value;
      const onda = document.getElementById('onda') ? document.getElementById('onda').value : null;
      const categoria = document.getElementById('categoria') ? document.getElementById('categoria').value : null;
      const gfManual = parseFloat(document.getElementById('gf').value);
      
      debugLog(`Par√¢metros: Peso=${peso}, Habilidade=${habilidade}, GF=${gfManual}`);
      
      // Calcular volume
      const volume = calcularVolume(peso, habilidade, idade, condicao, onda, gfManual);
      const recomendacao = getRecomendacao(volume, habilidade);
      
      debugLog(`Volume calculado: ${volume}L`);
      
      // Mostrar resultado
      const resultadoDiv = document.getElementById('resultado');
      resultadoDiv.innerHTML = `
        <div class="volume-display">${volume}L</div>
        <div><strong>Volume ideal calculado</strong></div>
        <div style="margin-top: 12px; font-size: 0.9em;">${recomendacao}</div>
        <div style="margin-top: 8px; font-size: 0.85em; color: #888;">GF usado: <b>${gfManual}</b></div>
      `;
      resultadoDiv.style.display = 'block';
      
      // Buscar pranchas
      await buscarPranchas(volume, categoria);
    };

    // Valida√ß√£o em tempo real
    document.querySelectorAll('input[type="number"]').forEach(input => {
      input.addEventListener('blur', function() {
        const validation = validateForm();
        if (!validation.isValid) {
          this.style.borderColor = '#e74c3c';
        } else {
          this.style.borderColor = '#e1e8ed';
        }
      });
    });
    
    debugLog('Calculadora carregada e pronta');
  </script>
</body>
</html> 